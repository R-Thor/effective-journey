# ------------------------------------------------------------
# rust-devcontainer v00.01.01
# Minimal Rust + Neovim environment for direct container use
#
# Build:
#   podman build \
#     -f Containerfile-rust-devcontainer-v00.01.01 \
#     -t r-thor-rust-devcontainer:v00.01.01 \
#     -t r-thor-rust-devcontainer:latest \
#     .
#
# Run (mount ~/work/slush as workspace):
#   podman run --rm -it \
#     --user $(id -u):$(id -g) \
#     -v "$HOME/work/slush:/workspace" \
#     -w /workspace \
#     r-thor-rust-devcontainer:v00.01.01 \
#     bash
# ------------------------------------------------------------

# ------------------------------------------------------------
# Base image: Debian stable-slim
# ------------------------------------------------------------
FROM debian:stable-slim

# ------------------------------------------------------------
# Version metadata (semantic, narratable)
# ------------------------------------------------------------
LABEL org.opencontainers.image.version="v00.01.01"
LABEL org.opencontainers.image.title="rust-devcontainer"
LABEL org.opencontainers.image.description="Minimal Rust development environment on Debian stable-slim"

# ------------------------------------------------------------
# Noninteractive apt to avoid prompts during build
# ------------------------------------------------------------
ENV DEBIAN_FRONTEND=noninteractive

# ------------------------------------------------------------
# Install system dependencies + Neovim
# ------------------------------------------------------------
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        ca-certificates \
        curl \
        build-essential \
        pkg-config \
        git \
        openssl \
        libssl-dev \
        neovim \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# Set Neovim as default editor
# ------------------------------------------------------------
ENV EDITOR=nvim
ENV VISUAL=nvim
RUN update-alternatives --set editor /usr/bin/nvim

# ------------------------------------------------------------
# Install Rust via rustup (canonical upstream)
# ------------------------------------------------------------
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs \
      | sh -s -- -y --no-modify-path

# ------------------------------------------------------------
# Add cargo + rustc to PATH
# ------------------------------------------------------------
ENV PATH="/root/.cargo/bin:${PATH}"

# ------------------------------------------------------------
# Preinstall common Rust components
# ------------------------------------------------------------
RUN rustup component add rustfmt clippy

# ------------------------------------------------------------
# Default working directory (overridden at runtime)
# ------------------------------------------------------------
WORKDIR /workspace
